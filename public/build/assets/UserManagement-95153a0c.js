import{_ as V,C as N}from"./CustomSnackbar-c1d4435b.js";import{a as p,o as u,c as w,w as a,b as s,g as k,h as S,F,f as n,t as g,e as O,d as _,r as o,n as I,O as M,i as m,p as L,j}from"./app-20d5af6d.js";const P={name:"CreateEditUser",props:["visible","dataToEdit","error"],data(){return{errorFormBackend:null,roles:[],userData:{id:null,name:null,isActive:!0,role:null,phoneNumber:null},shouldCreateUser:!0}},computed:{errorMessage:{get(){return this.error&&this.error.length>0&&(this.errorFormBackend=[],this.errorFormBackend=this.error),this.errorFormBackend},set(t){this.errorFormBackend=[],this.errorFormBackend=t}},showDialog:{get(){return this.visible},set(t){t||this.$emit("close")}},editUserData:{get(){return this.dataToEdit.length>0?(this.userData.role=this.dataToEdit[0].role.name,this.userData.id=this.dataToEdit[0].id,this.userData.name=this.dataToEdit[0].name,this.userData.phoneNumber=this.dataToEdit[0].phone_number,this.userData.isActive=this.dataToEdit[0].is_active===1,this.shouldCreateUser=!1):this.resetUserDataAndDialogStatus(),this.userData},set(t){this.userData=t}}},mounted(){this.fetchAllRoles()},methods:{capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)},fetchAllRoles(){this.roles=[],p.post("/admin/get-roles").then(t=>{var e;this.roles=(e=t.data)==null?void 0:e.roles}).catch(t=>{console.log(t.response)})},resetUserDataAndDialogStatus(){this.errorFormBackend=[],this.shouldCreateUser=!0,this.userData={id:null,name:null,isActive:!0,role:null,phoneNumber:null}},createOrUpdateUser(){let t=this.formatDataForBackend();this.errorFormBackend=[],this.shouldCreateUser?this.$emit("create",t):this.$emit("edit",t)},formatDataForBackend(){return{id:this.userData.id,name:this.userData.name,is_active:this.userData.isActive,phone_number:this.userData.phoneNumber,role:this.userData.role}}}},R=n("span",{class:"text-h5 ml-4"},"User Profile",-1),q=n("div",null,"User role",-1),H={style:{color:"red","font-size":"14px"}};function G(t,e,z,A,c,r){const U=o("v-card-title"),v=o("v-text-field"),d=o("v-col"),h=o("v-radio"),C=o("v-radio-group"),f=o("v-row"),D=o("v-checkbox"),B=o("v-container"),E=o("v-card-text"),x=o("v-spacer"),b=o("v-btn"),l=o("v-card-actions"),y=o("v-card"),T=o("v-dialog");return u(),w(f,{justify:"center"},{default:a(()=>[s(T,{modelValue:r.showDialog,"onUpdate:modelValue":e[5]||(e[5]=i=>r.showDialog=i),persistent:"",width:"500"},{default:a(()=>[s(y,null,{default:a(()=>[s(U,null,{default:a(()=>[R]),_:1}),s(E,null,{default:a(()=>[s(B,null,{default:a(()=>[s(f,null,{default:a(()=>[s(d,{cols:"12"},{default:a(()=>[s(v,{modelValue:r.editUserData.name,"onUpdate:modelValue":e[0]||(e[0]=i=>r.editUserData.name=i),density:"compact",label:"Username",required:""},null,8,["modelValue"])]),_:1}),s(d,{cols:"12"},{default:a(()=>[s(v,{modelValue:r.editUserData.phoneNumber,"onUpdate:modelValue":e[1]||(e[1]=i=>r.editUserData.phoneNumber=i),density:"compact",label:"Phone number",required:""},null,8,["modelValue"])]),_:1}),s(d,{cols:"12"},{default:a(()=>[s(f,{class:"d-flex justify-start ml-2 mr-2"},{default:a(()=>[s(C,{inline:"",modelValue:r.editUserData.role,"onUpdate:modelValue":e[2]||(e[2]=i=>r.editUserData.role=i)},{label:a(()=>[q]),default:a(()=>[(u(!0),k(F,null,S(c.roles,i=>(u(),k("div",{key:i.name},[s(h,{label:r.capitalizeFirstLetter(i.name),value:i.name},null,8,["label","value"])]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(d,{cols:"12"},{default:a(()=>[s(D,{modelValue:r.editUserData.isActive,"onUpdate:modelValue":e[3]||(e[3]=i=>r.editUserData.isActive=i),density:"compact",color:"red",label:"Is Active",class:"ml-3"},null,8,["modelValue"])]),_:1}),r.errorMessage&&r.errorMessage.length>0?(u(),w(d,{key:0,cols:"12"},{default:a(()=>[n("span",H,g(r.errorMessage),1)]),_:1})):O("",!0)]),_:1})]),_:1})]),_:1}),s(l,null,{default:a(()=>[s(x),s(b,{variant:"text",onClick:e[4]||(e[4]=i=>r.showDialog=!1)},{default:a(()=>[_(" Close ")]),_:1}),s(b,{color:"green-darken-1",variant:"text",onClick:r.createOrUpdateUser},{default:a(()=>[_(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const J=V(P,[["render",G]]);const K={name:"UserManagement",data(){return{error:null,openCreateEditDialog:!1,snackbarColor:"success",showSnackbar:!1,snackbarMessage:null,users:[],dataToEdit:{}}},components:{CustomSnackbar:N,CreateEditUser:J,Link:I},mounted(){this.getUsers()},methods:{defineMyUserBgColor(t){return this.$page.props.auth.user.id===t},createUserDialog(){this.openCreateEditDialog=!0,this.dataToEdit={}},editUserDialog(t){this.openCreateEditDialog=!0,this.dataToEdit=this.users.filter(e=>e.id===t)},deleteUser(t){window.confirm("Do you really want to delete this user?")&&this.deleteUserOnBackend(t)},editUserOnBackend(t){p.post("/admin/edit-user",t).then(e=>{this.showSnackbarMessage(e.data.message,"success"),this.openCreateEditDialog=!1,e.data.redirect_to&&M.visit(e.data.redirect_to),this.getUsers()}).catch(e=>{this.error="",e.response.data.message&&(this.error=e.response.data.message),console.log(e.response)})},createUserOnBackend(t){p.post("/admin/create-user",t).then(e=>{this.showSnackbarMessage(e.data.message,"success"),this.getUsers(),this.openCreateEditDialog=!1}).catch(e=>{this.error="",e.response.data.message&&(this.error=e.response.data.message),console.log(e.response)})},deleteUserOnBackend(t){p.post("/admin/delete-user",{id:t}).then(e=>{e.data.redirect_to&&M.visit(e.data.redirect_to),e.data.message&&(this.showSnackbarMessage(e.data.message,"success"),this.getUsers())}).catch(e=>{console.log(e.response)})},getUsers(){this.users=[],p.post("/admin/get-users").then(t=>{this.users=t.data.users}).catch(t=>{console.log(t.response)})},showSnackbarMessage(t,e){this.snackbarMessage=t,this.snackbarColor=e,this.showSnackbar=!0}}},Q=t=>(L("data-v-aa71ca30"),t=t(),j(),t),W=Q(()=>n("thead",null,[n("tr",null,[n("th",{class:"text-left"}," ID "),n("th",{class:"text-left"}," Name "),n("th",{class:"text-left"}," Role "),n("th",{class:"text-left"}," Phone number "),n("th",{class:"text-left"}," Is Active "),n("th",{class:"text-left"}," Actions ")])],-1));function X(t,e,z,A,c,r){const U=o("CustomSnackbar"),v=o("Link"),d=o("v-icon"),h=o("v-btn"),C=o("v-spacer"),f=o("v-toolbar"),D=o("CreateEditUser"),B=o("v-table"),E=o("v-row"),x=o("v-container"),b=o("v-app");return u(),w(b,{"data-app":""},{default:a(()=>[s(U,{visible:c.showSnackbar,message:c.snackbarMessage,"snackbar-color":c.snackbarColor,onClose:e[0]||(e[0]=l=>c.showSnackbar=!1)},null,8,["visible","message","snackbar-color"]),s(f,{dark:"",prominent:""},{default:a(()=>[s(h,{color:"blue darken-1"},{default:a(()=>[s(v,{href:t.route("home")},{default:a(()=>[_("Home")]),_:1},8,["href"]),s(d,null,{default:a(()=>[_("mdi-home")]),_:1})]),_:1}),s(C),s(h,{icon:"",href:t.route("logout")},{default:a(()=>[s(d,null,{default:a(()=>[_("mdi-export")]),_:1})]),_:1},8,["href"])]),_:1}),s(D,{visible:c.openCreateEditDialog,dataToEdit:c.dataToEdit,error:c.error,onClose:e[1]||(e[1]=l=>c.openCreateEditDialog=!1),onEdit:r.editUserOnBackend,onCreate:r.createUserOnBackend},null,8,["visible","dataToEdit","error","onEdit","onCreate"]),s(x,{class:"fill-height"},{default:a(()=>[s(E,{class:"d-flex justify-center align-center"},{default:a(()=>[s(B,{density:"compact"},{top:a(()=>[s(h,{size:"small",color:"success",class:"mb-5 ml-2 mt-5",onClick:r.createUserDialog},{default:a(()=>[_("Create user ")]),_:1},8,["onClick"])]),default:a(()=>[W,n("tbody",null,[(u(!0),k(F,null,S(c.users,l=>(u(),k("tr",{key:l.phone_number},[n("td",{class:m([{"custom-bg-color":r.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.id),3),n("td",{class:m([{"custom-bg-color":r.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.name),3),n("td",{class:m([{"custom-bg-color":r.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.role.name),3),n("td",{class:m([{"custom-bg-color":r.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.phone_number),3),n("td",{class:m([{"custom-bg-color":r.defineMyUserBgColor(l.id)},"custom-font-size d-flex justify-center align-center"])},[s(d,{size:"small",color:`${l.is_active===1?"success":"error"}`,icon:`${l.is_active===1?"mdi-check":"mdi-close"}`},null,8,["color","icon"])],2),n("td",{class:m(["custom-font-size",{"custom-bg-color":r.defineMyUserBgColor(l.id)}])},[s(d,{onClick:y=>r.editUserDialog(l.id),color:"blue",size:"small",icon:"mdi-pencil"},null,8,["onClick"]),s(d,{onClick:y=>r.deleteUser(l.id),color:"red",size:"small",icon:"mdi-delete",class:"ml-3"},null,8,["onClick"])],2)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})}const $=V(K,[["render",X],["__scopeId","data-v-aa71ca30"]]);export{$ as default};
