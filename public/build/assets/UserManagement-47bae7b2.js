import{_ as V,C as N}from"./CustomSnackbar-ef62ff4a.js";import{a as f,o as m,c as M,w as a,b as s,g as U,h as S,F as A,f as n,t as g,e as O,d as u,r,n as I,O as w,i as h,p as L,j}from"./app-ee36906e.js";const P={name:"CreateEditUser",props:["visible","dataToEdit","error"],data(){return{errorFormBackend:null,roles:[],userData:{id:null,name:null,isActive:!0,role:null,phoneNumber:null},shouldCreateUser:!0}},computed:{errorMessage:{get(){return this.error&&this.error.length>0&&(this.errorFormBackend=[],this.errorFormBackend=this.error),this.errorFormBackend},set(t){this.errorFormBackend=[],this.errorFormBackend=t}},showDialog:{get(){return this.visible},set(t){t||this.$emit("close")}},editUserData:{get(){return this.dataToEdit.length>0?(this.userData.role=this.dataToEdit[0].role.name,this.userData.id=this.dataToEdit[0].id,this.userData.name=this.dataToEdit[0].name,this.userData.phoneNumber=this.dataToEdit[0].phone_number,this.userData.isActive=this.dataToEdit[0].is_active===1,this.shouldCreateUser=!1):this.resetUserDataAndDialogStatus(),this.userData},set(t){this.userData=t}}},mounted(){this.fetchAllRoles()},methods:{capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)},fetchAllRoles(){this.roles=[],f.post("/admin/get-roles").then(t=>{var e;this.roles=(e=t.data)==null?void 0:e.roles}).catch(t=>{console.log(t.response)})},resetUserDataAndDialogStatus(){this.errorFormBackend=[],this.shouldCreateUser=!0,this.userData={id:null,name:null,isActive:!0,role:null,phoneNumber:null}},createOrUpdateUser(){let t=this.formatDataForBackend();this.errorFormBackend=[],this.shouldCreateUser?this.$emit("create",t):this.$emit("edit",t)},formatDataForBackend(){return{id:this.userData.id,name:this.userData.name,is_active:this.userData.isActive,phone_number:this.userData.phoneNumber,role:this.userData.role}}}},R=n("span",{class:"text-h5 ml-4"},"User Profile",-1),q=n("div",null,"User role",-1),H={style:{color:"red","font-size":"14px"}};function G(t,e,z,F,c,o){const C=r("v-card-title"),v=r("v-text-field"),d=r("v-col"),_=r("v-radio"),D=r("v-radio-group"),p=r("v-row"),B=r("v-checkbox"),E=r("v-container"),x=r("v-card-text"),y=r("v-spacer"),b=r("v-btn"),l=r("v-card-actions"),k=r("v-card"),T=r("v-dialog");return m(),M(p,{justify:"center"},{default:a(()=>[s(T,{modelValue:o.showDialog,"onUpdate:modelValue":e[5]||(e[5]=i=>o.showDialog=i),persistent:"",width:"500"},{default:a(()=>[s(k,null,{default:a(()=>[s(C,null,{default:a(()=>[R]),_:1}),s(x,null,{default:a(()=>[s(E,null,{default:a(()=>[s(p,null,{default:a(()=>[s(d,{cols:"12"},{default:a(()=>[s(v,{modelValue:o.editUserData.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.editUserData.name=i),density:"compact",label:"Username",required:""},null,8,["modelValue"])]),_:1}),s(d,{cols:"12"},{default:a(()=>[s(v,{modelValue:o.editUserData.phoneNumber,"onUpdate:modelValue":e[1]||(e[1]=i=>o.editUserData.phoneNumber=i),density:"compact",label:"Phone number",required:""},null,8,["modelValue"])]),_:1}),s(d,{cols:"12"},{default:a(()=>[s(p,{class:"d-flex justify-start ml-2 mr-2"},{default:a(()=>[s(D,{inline:"",modelValue:o.editUserData.role,"onUpdate:modelValue":e[2]||(e[2]=i=>o.editUserData.role=i)},{label:a(()=>[q]),default:a(()=>[(m(!0),U(A,null,S(c.roles,i=>(m(),U("div",{key:i.name},[s(_,{label:o.capitalizeFirstLetter(i.name),value:i.name},null,8,["label","value"])]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(d,{cols:"12"},{default:a(()=>[s(B,{modelValue:o.editUserData.isActive,"onUpdate:modelValue":e[3]||(e[3]=i=>o.editUserData.isActive=i),density:"compact",color:"red",label:"Is Active",class:"ml-3"},null,8,["modelValue"])]),_:1}),o.errorMessage&&o.errorMessage.length>0?(m(),M(d,{key:0,cols:"12"},{default:a(()=>[n("span",H,g(o.errorMessage),1)]),_:1})):O("",!0)]),_:1})]),_:1})]),_:1}),s(l,null,{default:a(()=>[s(y),s(b,{variant:"text",onClick:e[4]||(e[4]=i=>o.showDialog=!1)},{default:a(()=>[u(" Close ")]),_:1}),s(b,{color:"green-darken-1",variant:"text",onClick:o.createOrUpdateUser},{default:a(()=>[u(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const J=V(P,[["render",G]]);const K={name:"UserManagement",data(){return{error:null,openCreateEditDialog:!1,snackbarColor:"success",showSnackbar:!1,snackbarMessage:null,users:[],dataToEdit:{}}},components:{CustomSnackbar:N,CreateEditUser:J,Link:I},mounted(){this.getUsers()},methods:{loginAsUser(t){f.post("/admin/login-as",{id:t}).then(e=>{e.data.redirect_to&&w.visit(e.data.redirect_to)}).catch(e=>{console.log(e.response)})},defineMyUserBgColor(t){return this.$page.props.auth.user.id===t},createUserDialog(){this.openCreateEditDialog=!0,this.dataToEdit={}},editUserDialog(t){this.openCreateEditDialog=!0,this.dataToEdit=this.users.filter(e=>e.id===t)},deleteUser(t){window.confirm("Do you really want to delete this user?")&&this.deleteUserOnBackend(t)},editUserOnBackend(t){f.post("/admin/edit-user",t).then(e=>{this.showSnackbarMessage(e.data.message,"success"),this.openCreateEditDialog=!1,e.data.redirect_to&&w.visit(e.data.redirect_to),this.getUsers()}).catch(e=>{this.error="",e.response.data.message&&(this.error=e.response.data.message),console.log(e.response)})},createUserOnBackend(t){f.post("/admin/create-user",t).then(e=>{this.showSnackbarMessage(e.data.message,"success"),this.getUsers(),this.openCreateEditDialog=!1}).catch(e=>{this.error="",e.response.data.message&&(this.error=e.response.data.message),console.log(e.response)})},deleteUserOnBackend(t){f.post("/admin/delete-user",{id:t}).then(e=>{e.data.redirect_to&&w.visit(e.data.redirect_to),e.data.message&&(this.showSnackbarMessage(e.data.message,"success"),this.getUsers())}).catch(e=>{console.log(e.response)})},getUsers(){this.users=[],f.post("/admin/get-users").then(t=>{this.users=t.data.users}).catch(t=>{console.log(t.response)})},showSnackbarMessage(t,e){this.snackbarMessage=t,this.snackbarColor=e,this.showSnackbar=!0}}},Q=t=>(L("data-v-3023b6dc"),t=t(),j(),t),W=Q(()=>n("thead",null,[n("tr",null,[n("th",{class:"text-left"}," ID "),n("th",{class:"text-left"}," Name "),n("th",{class:"text-left"}," Role "),n("th",{class:"text-left"}," Phone number "),n("th",{class:"text-left"}," Is Active "),n("th",{class:"text-left"}," Actions ")])],-1));function X(t,e,z,F,c,o){const C=r("CustomSnackbar"),v=r("Link"),d=r("v-icon"),_=r("v-btn"),D=r("v-spacer"),p=r("v-toolbar"),B=r("CreateEditUser"),E=r("v-table"),x=r("v-row"),y=r("v-container"),b=r("v-app");return m(),M(b,{"data-app":""},{default:a(()=>[s(C,{visible:c.showSnackbar,message:c.snackbarMessage,"snackbar-color":c.snackbarColor,onClose:e[0]||(e[0]=l=>c.showSnackbar=!1)},null,8,["visible","message","snackbar-color"]),s(p,{dark:"",prominent:""},{default:a(()=>[s(_,{color:"blue darken-1"},{default:a(()=>[s(v,{href:t.route("home")},{default:a(()=>[u("Home")]),_:1},8,["href"]),s(d,null,{default:a(()=>[u("mdi-home")]),_:1})]),_:1}),s(D),s(_,{icon:"",href:t.route("logout")},{default:a(()=>[s(d,null,{default:a(()=>[u("mdi-export")]),_:1})]),_:1},8,["href"])]),_:1}),s(B,{visible:c.openCreateEditDialog,dataToEdit:c.dataToEdit,error:c.error,onClose:e[1]||(e[1]=l=>c.openCreateEditDialog=!1),onEdit:o.editUserOnBackend,onCreate:o.createUserOnBackend},null,8,["visible","dataToEdit","error","onEdit","onCreate"]),s(y,{class:"fill-height"},{default:a(()=>[s(x,{class:"d-flex justify-center align-center"},{default:a(()=>[s(E,{density:"compact"},{top:a(()=>[s(_,{size:"small",color:"success",class:"mb-5 ml-2 mt-5",onClick:o.createUserDialog},{default:a(()=>[u("Create user ")]),_:1},8,["onClick"])]),default:a(()=>[W,n("tbody",null,[(m(!0),U(A,null,S(c.users,l=>(m(),U("tr",{key:l.phone_number},[n("td",{class:h([{"custom-bg-color":o.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.id),3),n("td",{class:h([{"custom-bg-color":o.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.name),3),n("td",{class:h([{"custom-bg-color":o.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.role.name),3),n("td",{class:h([{"custom-bg-color":o.defineMyUserBgColor(l.id)},"custom-font-size"])},g(l.phone_number),3),n("td",{class:h([{"custom-bg-color":o.defineMyUserBgColor(l.id)},"custom-font-size d-flex justify-center align-center"])},[s(d,{size:"small",color:`${l.is_active===1?"success":"error"}`,icon:`${l.is_active===1?"mdi-check":"mdi-close"}`},null,8,["color","icon"])],2),n("td",{class:h(["custom-font-size",{"custom-bg-color":o.defineMyUserBgColor(l.id)}])},[s(d,{onClick:k=>o.editUserDialog(l.id),color:"blue",size:"small",icon:"mdi-pencil"},null,8,["onClick"]),s(d,{onClick:k=>o.deleteUser(l.id),color:"red",size:"small",icon:"mdi-delete",class:"ml-3"},null,8,["onClick"]),s(_,{size:"small",color:l.is_active===1?"success":"",class:"ml-3",disabled:l.is_active===0||t.$page.props.auth.user.id===l.id,onClick:k=>o.loginAsUser(l.id)},{default:a(()=>[u(" login ")]),_:2},1032,["color","disabled","onClick"])],2)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})}const $=V(K,[["render",X],["__scopeId","data-v-3023b6dc"]]);export{$ as default};
